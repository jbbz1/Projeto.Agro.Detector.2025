<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
  <link type="text/css" rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css" />
  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <link type="text/css" rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" />
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agro Detector</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet-distortableimage/dist/leaflet.distortableimage.css" />
<script src="https://unpkg.com/leaflet-distortableimage/dist/leaflet.distortableimage.js"></script>
  <style>
    .leaflet-control-layers {
      vertical-align: middle;
      top: -10px;
      /* distância do topo */
      left: -10px;
      /* distância da esquerda */
    }



    .leaflet-control-layers-expanded {
      font-size: 5px;
    }













    .relatorio-btn {
      position: absolute;
      top: 140px;
      right: 115px;
      z-index: 9999;
      border: 2px solid #333;
      font-weight: bold;
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      font-family: Arial, sans-serif;
      background-color: #007bff;
      color: white;
      font-size: 12px;
      border-radius: 4px;
      transition: background-color 0.3s ease;
      text-align: center;
      max-width: 140px;
      margin: 0 auto;
      /* centraliza se quiser */

    }

    .relatorio-btn:hover {
      background-color: #e8f0fe;
      color: #1a73e8;
      transform: scale(1.05);
    }

    html,
    body {
      margin: 0 !important;
      padding: 0 !important;
      overflow-x: hidden !important;
      /* impede rolagem horizontal */

    }

    body {
      min-height: 10vh;
      display: flex;
      flex-direction: column;

    }

    #filtros {
      position: absolute;
      left: 0px;
      top: 70%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 10px;
      border-radius: 10px;
      box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
      z-index: 999;
    }

    #overlay-carregando {
      display: none;
      /* agora sim funciona! */
      position: fixed;
      z-index: 99999;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
    }

    .container-spinner {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .spinner {
      border: 10px solid #f3f3f3;
      /* borda geral mais grossa */
      border-top: 15px solid #00a86b;
      /* borda superior mais grossa e cor corrigida (#00a86b) */
      border-radius: 50%;
      width: 80px;
      height: 80px;
      animation: girar 0.12s linear infinite;
      /* velocidade bem rápida */
      margin-bottom: 20px;
    }

    .texto {
      color: white;
      font-size: 1.2em;
      font-weight: bold;
      text-align: center;
    }

    @keyframes girar {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }



    /* Coleta e Mapeamento de Resíduos Tóxicos e Microplásticos
 */
    .subtext {
      font-size: 0.5rem;
      color: #66;
      margin-top: -9px;
      line-height: 1;
      color: white;
    }


    .relatorio-btn {}


    .cabecalho {
      position: relative;
      padding-left: 150px;
      /* espaço para o texto à esquerda */
      font-size: 24px;
      font-weight: bold;
      /* opcional: cor de fundo suave */
      padding: 20px;
    }


    .fase4 {
      position: absolute;
      top: 0;
      /* topo da tela ou container pai */
      left: 8%;
      transform: translateX(-50%);
      font-size: 12px;
      color: #0000CD;
      font-weight: normal;
      width: auto;
      height: 10px;
      text-align: left;
      top: 40px;
      /* Distância do topo */
    }




    .leaflet-control-attribution {
      bottom: 0px !important;
      /* distância da base */
      right: 720px !important;
      /* distância da direita */
      background-color: rgba(0, 0, 0, 0.0);
      /* mais legível */
      font-size: 0.0000001px;
      padding: 1px 1px;
      border-radius: 1px;
    }


    /* config das caixas das posiçoes coletadas  */
    .leaflet-popup {
      margin-bottom: 10px;
    }

    .leaflet-popup-content-wrapper {
      width: 30.5em;
      background-color: rgba(30, 30, 30, 0.6);
      border-radius: 50px;
      box-shadow: 0 0 100px rgba(0, 255, 136, 0.3);
      padding: 45px;
    }

    .leaflet-popup-content {
      font-size: 1.4em;
      font-weight: bold;
      color: #00ff88;
      text-align: center;
      margin: 10;
    }

    .leaflet-popup-tip {
      background: #1e1e1e;
      width: 30px;
      height: 20px;
    }



    @media (max-width: 576px) {
 


      .counters-container {
        position: absolute;
        top: 15% !important;
        left: 10% !important;
        z-index: 999;
        display: flex;
        gap: 20px;
      }

      .counter-box {
        padding: 12px 16px;
        border-radius: 16px;
        text-align: center;
        width: 160px;
         width: 140px;
        padding: 10px 14px;
      }

      .counter-box i {
        font-size: 28px;
        margin-bottom: 6px;
        
      }

      .counter-number {
        font-size: 26px;
        font-weight: bold;
        margin-bottom: 4px;
      }



      .leaflet-control-layers {
        vertical-align: middle;
        top: 170px !important;
        left: -10px !important;
      }

      .leaflet-control-layers-expanded {
        font-size: 5px;
      }

      #filtros {
        position: absolute;
        left: 0px;
        top: 70%;
        padding: 10px;
      }

      .cabecalho {
        text-align: center;
        padding: 0px;
        color: #00ff88;
        font-family: 'Arial', sans-serif;
        font-size: 1.8em !important;
      }

      nav {
        display: grid;
        grid-template-columns: repeat(2, 1fr) !important;
        grid-template-rows: repeat(2, auto) !important;
        gap: 0px !important;
        width: 457px !important;
        margin-right: 10px !important;
        justify-content: start !important;

      }

      nav a {
        display: flex !important;
        justify-content: center !important;
        align-items: center !important;
        height: 20px !important;
        background-color: #00a9c9 !important;
        color: black !important;
        font-weight: bold !important;
        border: 2px solid white !important;
        border-radius: 33px !important;
      }

      .sidebar {
        display: none !important;
      }

      .sidebar-title {
        color: #333;
        font-family: 'Arial', sans-serif;
        font-size: 10px;
        font-weight: bold;
        margin: 0 auto;
        text-align: center;
        width: 100%;
        padding: 5px 0;
      }

      .sidebar img {
        max-width: 80%;
        margin: 50px 4;
        border-radius: 5px;
        transition: transform 0.2s ease;
        cursor: pointer;
      }

      .sidebar img:hover {
        transform: scale(1.05);
      }

      .logos {
        display: flex;
        flex-direction: column;
        gap: 0 !important;
        px;
        align-items: center;
      }

      .logo {
        height: auto;
        width: 65px !important; //tamanho da imagem logo
        height: auto;
        gap: 0px;
      }

      #rodape img {
        width: 10% !important;
        height: auto !important;
        display: block;
        margin: 20px auto;
      }

      footer img {
        position: absolute;
        bottom: 10px;
        left: 10px;
        height: 75px;
        z-index: 9999;
      }
    }

    .fase4 {
      display: none !important;
    }

    /* {
      outline: 1px solid red;
    }*/

    /* Estilos gerais do site */
    .box {
      display: inline-block;
      background-color: #1e1e1e;
      color: #00ff88;
      padding: 0px 20px;
      margin: 1px;
      border-radius: 15px;
      cursor: pointer;
      font-family: 'Arial', sans-serif;
      font-size: 1.8em;
      font-weight: bold;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      box-shadow: 40px 0 50px rgba(0, 255, 136, 0.2);
    }

    .box:hover {
      transform: scale(1.05);
      box-shadow: 0px 0 15px rgba(0, 255, 136, 0.5);
    }

    .cabecalho {
      text-align: center;
      padding: 0px;
      color: #00ff88;
      font-family: 'Arial', sans-serif;
      font-size: 3em;
    }

    .logos a {
      display: block;
      margin: 10px 0;
    }

    .logo {
      max-width: 75%;
      /* Para aumentar logo  */

      height: auto;

      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: scale(1.1);
    }

      {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Arial', sans-serif;
      font-weight: bold;
      background-color: #000;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    #map {
      flex-grow: 1;
      /* Para ocupar o espaço disponível */
    }

    /* config roda pé */
    footer {
      color: #00ff88;
      padding: 0px 0px;
      font-family: 'Arial', sans-serif;
      font-size: 0.95em;
      text-align: center;
      position: relative;
      /* sombra suave */
      margin-top: auto;
    }

    footer img {
      position: absolute;
      bottom: 10px;
      /* Ajuste vertical */
      left: 10px;
      /* Ajuste horizontal */
      height: 100px;
      z-index: 9999;
    }

    .container {
      min-height: %;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
    }

    .footer-text {
      margin: -20px 0;
      line-height: 01.2em;
    }

    /* Barra lateral fixa no lado direito */
    .sidebar {
      position: fixed;
      top: -10%;
      right: 1px;
      transform: translateY(30%);
      width: 220px;
      /* largura aumentada pra caber duas colunas de 100px */
      background-color: #ffffff;
      padding: 14px;
      border-radius: 10px 0 50px;
      box-shadow: -3px 3px 10px rgba(0, 0, 0, 0.2);
      z-index: 500;
      text-align: center;
      overflow-y: auto;
      /* rolagem se tiver muitos logos */
      max-height: 80vh;
    }

    .sidebar-title {
      color: #333;
      font-family: 'Arial', sans-serif;
      font-size: 15px;
      font-weight: bold;
      margin: 0 auto;
      text-align: center;
      width: 100%;
      padding: 1px 0;
    }

    .logos {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      /* DUAS COLUNAS */
      gap: 10px;
      justify-items: center;
      align-items: center;
      font-family: 'Arial', sans-serif;
    }

    .logo {
      width: 100px;
      /* tamanho EXATO solicitado */
      height: auto;
      border-radius: 5px;
      transition: transform 0.2s ease;
      cursor: pointer;
    }

    .logo:hover {
      transform: scale(1.05);
    }

    .counters-container {
      position: absolute;
      top: 15%;
      left: 40%;
      z-index: 999;
      display: flex;
      gap: 20px;
    }

    .counter-box {
      background-color: #1a1a1a;
      color: white;
      padding: 12px 16px;
      border-radius: 16px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.4);
      text-align: center;
      width: 160px;
      font-family: sans-serif;
    }

    .counter-box i {
      font-size: 28px;
      margin-bottom: 6px;
      display: block;
    }

    .counter-number {
      font-size: 26px;
      font-weight: bold;
      color: #00ff88;
      margin-bottom: 4px;
    }

    .toxic i {
      color: #ff4444;
    }

    .domestic i {
      color: #44ff44;
    }

    .counter-label {
      font-size: 14px;
      line-height: 1.2;
    }


    .counter-label {
      text-align: center;
      font-size: 14px;
    }

    #map {
      height: 50vh;
      width: 100%;

    }

    /* === ÍCONES PERSONALIZADOS === */
    .custom-icon-green,
    .custom-icon-red {
      border-radius: 50%;
      width: 16px;
      height: 16px;
      display: inline-block;

    }

    .custom-icon-green {
      background-color: #00FF00;
    }

    .custom-icon-red {
      background-color: #FF0000;
    }

    /* Estilo do menu */
    nav {
      display: flex;
      flex-wrap: wrap;
      justify-content: left;
      gap: 0px;
      background-color: #000000;
      padding: 0px;

    }

    .box {
      padding: 1px 4px;
      background-color: #008CBA;
      color: black;
      cursor: pointer;
      border-radius: 54px;
      text-align: center;
      font-weight: bold;
      border: 0.001px solid white;
      text-decoration: none;
      font-size: 19px;
    }

    .box:hover {
      background: linear-gradient(45deg, #008CBA, #00FFD1);
    }



    #mapContainer {
  position: relative;
  width: 100%; /* ou largura fixa tipo 800px */
  max-width: 800px;
}

#mapContainer img {
  width: 100%;
  display: block;
}

#camadaRioEncantado {
  position: absolute;
  top: 1000;
  left: -500;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s;
}
  </style>

<body>
  <!-- Barra lateral fixa à direita para logomarcas -->
  <div class="sidebar">
    <h3 class="sidebar-title">Apoiadores</h3>
    <div class="logos">
      <a href="https://www.pmpr.pr.gov.br/Pagina/Patrulha-Rural-Comunitaria target=" _blank"title="31º B. de Pol. Mil.">
        <img src="apoiadores/bpmrural.png" alt="31º B. de Pol. Mil. Rural" class="logo">
      </a>
      <a href="https://www.pmpr.pr.gov.br/31BPM" target="_blank" title="31º B. de Pol. Mil.">
        <img src="apoiadores/bpm.png" alt="31º B. de Pol. Mil." class="logo">
      </a>
      <a href="https://www.instagram.com/agro.fortuna/" target="_blank" title="Agro Fortuna">
        <img src="apoiadores/agrofortuna.png" alt="Agro Fortuna" class="logo">
      </a>
      <a href="https://www.assischateaubriand.pr.gov.br/index.php?sessao=b054603368svb0&id=3996" target="_blank"
        title="Sec. de Serviços Urb.">
        <img src="apoiadores/secretariadeserviçosurbanos.png" alt="Sec. de Serviços Urb." class="logo">
      </a>
      <a href="https://kspulverizadores.com.br/index.php" target="_blank" title="KS Pulverizadores">
        <img src="apoiadores/ks.png" alt="KS Pulverizadores" class="logo">
      </a>
      <a href="https://www.instagram.com/atacadopedroedavi/" target="_blank" title="Atacado Pedro e Davi">
        <img src="apoiadores/atacado.png" alt="Atacado Pedro e Davi" class="logo">
      </a>
      <a href="https://www.instagram.com/ambiental.assis/" target="_blank"
        title="Departamento de Meio Ambiente de Assis Chateaubriand">
        <img src="apoiadores/meioambiente.png" alt="Dep. Meio Ambiente" class="logo">
      </a>
      <a href="https://www.instagram.com/junior_colchoes?igsh=aTAwYWE4NGRyeno=" target="_blank" title="Junior Colchões">
        <img src="apoiadores/jrc.png" alt="Junior Colchões" class="logo">
      </a>
      <a href="https://www.instagram.com/ccmguima?igsh=YjRtOTlybGUyaDFn" target="_blank" title="CCM Guima">
        <img src="apoiadores/Guima.png" alt="CCM Guima" class="logo">
      </a>
      <a href="https://www.instagram.com/sindicatoruraldeassischat?igsh=MXN0aHhpeTNqN2Jsbg==" target="_blank"
        title="Senar Assis">
        <img src="apoiadores/Senar_Assis.png" alt="Senar Assis" class="logo">
      </a>
      <a href="https://www.camarassis.pr.gov.br/" target="_blank" title="Câmara Assis">
        <img src="apoiadores/camara.png" alt="Câmara Assis" class="logo">
      </a>
      <a href="https://www.instagram.com/motopauto1687/" target="_blank" title="Moto Pauto">
        <img src="apoiadores/motopauto.png" alt="Moto Pauto" class="logo">
      </a>
      <a href="https://www.instagram.com/crissaviamentos/" target="_blank" title="Criss Aviamentos">
        <img src="apoiadores/crisaviamentos.png" alt="Criss" class="logo">
      </a>
      <a href="https://www.centrocon.net/" target="_blank" title="Centrocon">
        <img src="apoiadores/centro.png" alt="Centrocon" class="logo">
      </a>
      <a href="https://www.instagram.com/caseshowassis/" target="_blank" title="Case Show Assis">
        <img src="apoiadores/case.png" alt="Case Show" class="logo">
      </a>
      <a href="https://www.instagram.com/agr_opecuariabichobom/" target="_blank" title="Bicho Bom Agro.">
        <img src="apoiadores/bichobom.png" alt="Bicho Bom Agropecuária" class="logo">
      </a>
      <a href="https://www.instagram.com/assisfertil/" target="_blank" title="Assis Fertil">
        <img src="apoiadores/assisfertil.png" alt="AssisFertil" class="logo">
      </a>
      <a href="https://www.assischateaubriand.pr.gov.br/" target="_blank" title="Pref. M. Assis Chateaubriand">
        <img src="apoiadores/pref.png" alt="Pref. M. Assis Chateaubriand" class="logo">
      </a>
      <a href="https://iriedi.com.br/" target="_blank" title="IRIEDI">
        <img src="apoiadores/iriedi.png" alt="IRIEDI" class="logo">
      </a>
    </div>

  </div>

  <head>

  </head>

  <body>

    <header class="cabecalho">
      <div class="fase4">Fase 4 (Resultados)</div>


      Projeto Agro Detector
      <div class="subtext">
        <span>Coleta e Mapeamento de Resíduos Tóxicos e Microplásticos</span><br>
      </div>
    </header>

  </body>
  <!-- Plugin para imagem interativa -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-distortableimage@0.12.0/dist/leaflet.distortableimage.css" />
<script src="https://unpkg.com/leaflet-distortableimage@0.12.0/dist/leaflet.distortableimage.js"></script>
  <!-- Menu horizontal -->
  <nav>
    <a href="projeto.html" class="box">Projeto</a>

    <a href="frascosencontrados.html" class="box">Frascos</a>

    <a href="noticias.html" class="box">Noticias</a>

    <a href="comofunciona.html" class="box">Componentes</a>

    <a href="ideia.html" class="box">Ideia</a>

    <a href="materiais.html" class="box">Materiais</a>

    <a href="experiencia.html" class="box">Experiência</a>

    <a href="agradecimentos.html" class="box">Agradecimentos</a>

    <a href="fotos_projeto_agro_detector.html" class="box"> Fotos</a>

    <a href="apresentacao.html" class="box">Professor</a>

    <a href="apresentacaoalunos.html" class="box">Alunos</a>
  </nav>

  <!-- Balões de contadores sobre o mapa -->
  <div class="counters-container">
    <div class="counter-box toxic">
      <i class="fas fa-exclamation-triangle"></i>
      <div class="counter-number" id="toxic-count">47</div>
      <div class="counter-label">
        <span>Frascos</span><br>
        <span>tóxicos coletados</span>
      </div>

      <button class="relatorio-btn" onclick="gerarPDF()">📄  Relatório PDF</button>

    </div>
    <div class="counter-box domestic">
      <i class="fas fa-trash-alt"></i>
      <div class="counter-number" id="domestic-count">67</div>
      <div class="counter-label">
        <span>Lixo Doméstico</span><br>
        <span>a Coletar</span>
      </div>
    </div>
  </div>

  </div>

  </div>

<!-- Filtros laterais -->
<div id="filtros">
  <label>
    <input type="checkbox" id="mostrarDomestico" checked />
    Doméstico
  </label><br>
  <label>
    <input type="checkbox" id="mostrarToxico" checked />
    Tóxico
  </label><br>
  <label>
    <input type="checkbox" id="mostrarHidrico" onchange="toggleCamadaHidrica()" />
    Hídrico
  </label>
</div>

<!-- Contêiner do mapa -->
<div id="mapContainer">
  <img src="icones/mapa_base.png" alt="Mapa Base" id="mapaBase">
  
  <!-- Camada do Rio Encantado (sua imagem PNG sobreposta) -->
  <img src="icones/rio_encantado.png" alt="Camada Hídrica" id="camadaRioEncantado">
</div>

  </div>

  <div id="map"></div> <!-- Leaflet CSS + JS -->

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // Camadas base
  var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  });
  var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
    attribution: '© Esri, Earthstar Geographics'
  });
  var esriLabels = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}', {
    attribution: '© Esri, Earthstar Geographics'
  });
  // Sua camada topológica só adicionada aqui
  var topoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenTopoMap (CC-BY-SA)'
  });

  // Coordenadas (ajuste conforme a localização real do Rio Encantado)
const bounds = [
 [-24.375 - .285, -53.59 - 0.285], // [-24.510, -53.710]
  [-24.375 + .285, -53.59 + 0.285]  // [-24.240, -53.470]
];

// Cria a camada de imagem mas ainda não adiciona
const camadaRioEncantado = L.imageOverlay('icones/rio_encantado.png', bounds);

// Variável para controlar visibilidade
let camadaHidricaVisivel = false;

// Função para ativar/desativar camada
function toggleCamadaHidrica() {
  const checkbox = document.getElementById("mostrarHidrico");

  if (checkbox.checked) {
    camadaRioEncantado.addTo(map); // <-- CORRETO!
  } else {
    map.removeLayer(camadaRioEncantado); // <-- CORRETO!
  }
}
  // Camada híbrida (Satélite + Nomes)
  var hibrido = L.layerGroup([esriSat, esriLabels]); 

  // Inicializa o mapa COM a camada híbrida ativa
  var map = L.map('map', { 
    center: [-24.405990, -53.513975],
    zoom: 6,
    minZoom: 2,
    maxZoom: 18,
    zoomControl: false,
    layers: [hibrido] // <- ESSA LINHA ativa o híbrido ao iniciar
  });
  // Botão de troca de camadas no canto superior esquerdo
  var baseMaps = {
    " Ruas": osm,
    "Satélite": esriSat,
    "Híbrido": hibrido,
    "Topográfico": topoMap
  };
  L.control.layers(baseMaps, null, { position: 'topleft' }).addTo(map);
   // Substituindo as divIcons pelos ícones PNG
var greenIcon = L.icon({
    iconUrl: 'icones/lixo dome.png', // Substitua pelo caminho do seu ícone PNG verde
    iconSize: [28, 28], // Tamanho do ícone
    iconAnchor: [16, 32], // Posição do ponto de ancoragem do ícone
    popupAnchor: [0, -32] // Posição do pop-up
});
var redIcon = L.icon({
    iconUrl: 'icones/lixo tox.png', // Substitua pelo caminho do seu ícone PNG vermelho
    iconSize: [28, 28], // Tamanho do ícone
    iconAnchor: [16, 32], // Posição do ponto de ancoragem do ícone
    popupAnchor: [0, -32] // Posição do pop-up
});
    let locations = [
 ////////////////////////////////////////////////////////////


{  
    "lat": -24.423113057483075,
    "lng": -53.50327401290417,
    "info": [
    "LIXO TÓXICO RECOLHIDO <a href=\"https://maps.google.com/maps/?&z=10&q=-24.423113057483075,-53.50327401290417\" target=\"_blank\">Ver Localização</a>",
    "DATA/HORA: 04/08/2025 15:52:00",
    "Temperatura: 21.50 °C",
    "<img src='frascos/IMG_20250722_170649.png' alt='Lixo Tóxico' width='125%' />"
    ],
    "icon": "redIcon"
},
      
////////////////////////////////////////////////////////////
        ];
       const marcadoresDomesticos = [];
  const marcadoresToxicos = [];

  let toxicoCount = 0;
  let domesticoCount = 0;

  locations.forEach(loc => {
    const icon = loc.icon === "greenIcon" ? greenIcon : redIcon;
    const popupContent = loc.info.join("<br>");

    const marker = L.marker([loc.lat, loc.lng], { icon }).bindPopup(popupContent);

    if (loc.icon === "greenIcon") {
      marcadoresDomesticos.push(marker);
      domesticoCount++;
    } else {
      marcadoresToxicos.push(marker);
      toxicoCount++;
    }

    marker.addTo(map);
  });

  // Atualiza contadores visuais, se existirem
  if (document.getElementById('toxic-count'))
    document.getElementById('toxic-count').textContent = toxicoCount;

  if (document.getElementById('domestic-count'))
    document.getElementById('domestic-count').textContent = domesticoCount;

  // Função para atualizar visibilidade dos marcadores
  function atualizarVisibilidade() {
    const mostrarDom = document.getElementById("mostrarDomestico").checked;
    const mostrarTox = document.getElementById("mostrarToxico").checked;

    marcadoresDomesticos.forEach(marker => {
      if (mostrarDom) {
        map.addLayer(marker);
      } else {
        map.removeLayer(marker);
      }
    });

    marcadoresToxicos.forEach(marker => {
      if (mostrarTox) {
        map.addLayer(marker);
      } else {
        map.removeLayer(marker);
      }
    });
  }
let rioAtivo = false;

function toggleRioEncantado() {
  const camada = document.getElementById("camadaRioEncantado");
  rioAtivo = !rioAtivo;
  camada.style.opacity = rioAtivo ? 1 : 0;
}
  // Eventos dos checkboxes
  document.getElementById("mostrarDomestico").addEventListener("change", atualizarVisibilidade);
  document.getElementById("mostrarToxico").addEventListener("change", atualizarVisibilidade);
  </script>
  </script>

  <script>
    async function gerarPDF() {
  const overlay = document.getElementById("overlay-carregando");
  overlay.style.display = "flex"; // Mostra o overlay com animação

  try {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

  // Separar os lixos tóxicos e domésticos
  let toxicos = [];
  let domesticos = [];

  locations.forEach(loc => {
    const tipoLimpo = loc.info[0].replace(/<[^>]*>/g, '').trim().toLowerCase();
    if (tipoLimpo.includes("tóxico")) toxicos.push(loc);
    else if (tipoLimpo.includes("doméstico")) domesticos.push(loc);
  });

  const dataHoje = new Date().toLocaleDateString();

  // Função que desenha cabeçalho na página atual
  function desenharCabecalho() {
    doc.setFillColor(173, 216, 230); // azul claro
    doc.rect(0, 0, 210, 25, 'F');

    doc.setFont("arial", "bold");
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);
    doc.text("Projeto Agro Detector", 10, 10);
    doc.text(`Data: ${dataHoje}`, 200, 10, { align: "right" });

    doc.setFontSize(11);
    doc.setTextColor(255, 0, 0);
    doc.text(`Total de Lixos Tóxicos: ${toxicos.length}`, 10, 20);
    doc.setTextColor(0, 128, 0);
    doc.text(`Total de Lixos Domésticos: ${domesticos.length}`, 100, 20);

    doc.setFont("arial", "normal");
    doc.setFontSize(14);
    doc.setTextColor(0, 0, 255);
    doc.text("Relatório de Coletas - Projeto Agro Detector", 10, 35);
    doc.setDrawColor(0);
    doc.line(10, 37, 200, 37);
  }

  // Função para carregar uma imagem PNG e converter para base64
 
async function carregarImagemBase64(url, maxLargura = 600, maxAltura = 400) {
  try {
    const img = new Image();
    img.crossOrigin = 'anonymous';

    return await new Promise((resolve, reject) => {
      img.onload = () => {
        // Redimensiona proporcionalmente
        let largura = img.width;
        let altura = img.height;
        const escala = Math.min(maxLargura / largura, maxAltura / altura, 1);
        largura *= escala;
        altura *= escala;

        // Cria o canvas redimensionado
        const canvas = document.createElement('canvas');
        canvas.width = largura;
        canvas.height = altura;
        const ctx = canvas.getContext('2d');
        ctx.drawImage(img, 0, 0, largura, altura);

        // Exporta em JPEG com compressão
        const base64 = canvas.toDataURL('image/jpeg', 0.7);
        resolve(base64);
      };

      img.onerror = (e) => {
        console.error("Erro ao carregar imagem:", e);
        reject(e);
      };

      img.src = url;
    });

  } catch (e) {
    console.error("Erro ao redimensionar imagem:", e);
    return null;
  }
}

  // Função para adicionar os lixos no PDF (assíncrona para tratar imagens)
  async function adicionarLixos(lista, corTexto, yStart) {
    let yLocal = yStart;

    for (const loc of lista) {
      if (yLocal > 270) {
        doc.addPage();
        desenharCabecalho();
        yLocal = 45;
      }

      // Extrair dados básicos
      const tipo = loc.info[0].replace(/<[^>]*>/g, '').trim();
      const dataHora = loc.info[1].replace("DATA/HORA: ", "").trim();
      const temp = loc.info[2].replace("Temperatura: ", "").trim();
      const lat = loc.lat.toFixed(6);
      const lng = loc.lng.toFixed(6);
      const mapsUrl = `https://maps.google.com/maps/?&z=10&q=${lat},${lng}`;

      doc.setFont("arial", "bold");
      doc.setTextColor(0, 0, 0);
      doc.text("Tipo de Lixo:", 10, yLocal);
      doc.setFont("arial", "normal");
      doc.setTextColor(...corTexto);
      doc.text(tipo, 50, yLocal);
      yLocal += 7;

      doc.setFont("arial", "bold");
      doc.setTextColor(0, 0, 0);
      doc.text("Data/Hora:", 10, yLocal);
      doc.setFont("arial", "normal");
      doc.text(dataHora, 50, yLocal);
      yLocal += 7;

      doc.setFont("arial", "bold");
      doc.text("Temperatura:", 10, yLocal);
      doc.setFont("arial", "normal");
      doc.text(temp, 50, yLocal);
      yLocal += 7;

      doc.setFont("arial", "bold");
      doc.text("Latitude:", 10, yLocal);
      doc.setFont("arial", "normal");
      doc.text(lat.toString(), 50, yLocal);
      yLocal += 7;

      doc.setFont("arial", "bold");
      doc.text("Longitude:", 10, yLocal);
      doc.setFont("arial", "normal");
      doc.text(lng.toString(), 50, yLocal);
      yLocal += 7;

      doc.setTextColor(0, 0, 255);
      doc.textWithLink("Localização no Google Maps (clique aqui)", 10, yLocal, { url: mapsUrl });
      yLocal += 10;

      // Procurar tag <img> no info e extrair o src da imagem
      let imgTag = loc.info.find(i => i.includes("<img"));
      if (imgTag) {
        const srcMatch = imgTag.match(/src=['"]([^'"]+)['"]/);
        if (srcMatch && srcMatch[1]) {
          const urlImagem = srcMatch[1];
          const imgBase64 = await carregarImagemBase64(urlImagem);

          if (imgBase64) {
            // Insere a imagem no pdf
            // Ajusta posição X, Y, largura e altura (pode ajustar conforme seu layout)
            doc.addImage(imgBase64, 'PNG', 130, yLocal - 50, 60, 45);
            yLocal += 50;
          } else {
            console.warn(`Não foi possível carregar a imagem: ${urlImagem}`);
          }
        }
      }

      doc.setDrawColor(200);
      doc.line(10, yLocal, 200, yLocal);
      yLocal += 10;
    }

    return yLocal;
  }

  // Desenha o cabeçalho na primeira página
   desenharCabecalho();
    let y = 45;
    y = await adicionarLixos(domesticos, [0, 128, 0], y);
    y = await adicionarLixos(toxicos, [255, 0, 0], y);

const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
if (isMobile) {
  const blobUrl = doc.output('bloburl');
  window.open(blobUrl, '_blank');
} else {
doc.save("Relatorio_Agro_Detector.pdf");
}

  } catch (erro) {
    console.error("Erro ao gerar PDF:", erro);
    alert("Ocorreu um erro ao gerar o relatório.");
  } finally {
    overlay.style.display = "none"; // Esconde depois de salvar ou erro
  }
}

  </script>




  <!-- Overlay com spinner e texto -->
  <div id="overlay-carregando" style="display:none; 
    position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.7); color:white; font-family: monospace; 
    z-index:9999; justify-content:center; align-items:center; flex-direction: column;">

    <div class="spinner" style="margin-bottom:20px;">
      <!-- Aqui você pode colocar uma animação de loading se quiser -->

    </div>
    <div class="texto">Gerando relatório, por favor aguarde...</div>
    <div id="checklist-status" style="text-align:left; max-width: 400px;">
      <div id="etapa1">🔍 Coletando dados...</div>
      <div id="etapa2">🧹 Limpando informações...</div>
      <div id="etapa3">📡 Buscando imagens...</div>
      <div id="etapa4">🧠 Convertendo imagens em base64...</div>
      <div id="etapa5">🎨 Redimensionando imagens...</div>
      <div id="etapa6">🖨️ Inserindo no PDF...</div>
      <div id="etapa7">📄 Finalizando relatório...</div>
    </div>
  </div>

  <script>
    async function gerarPDF() {
  const overlay = document.getElementById("overlay-carregando");
  
  // Função para atualizar as etapas do checklist
  function marcarEtapa(numero, texto) {
    const el = document.getElementById("etapa" + numero);
    if (el) {
      el.textContent = texto + " ✔️";
    }
  }

  // Exibe o overlay e inicia as etapas
  overlay.style.display = "flex";

  try {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    marcarEtapa(1, "🔍 Coletando dados...");
    // Separar os lixos tóxicos e domésticos
    let toxicos = [];
    let domesticos = [];

    locations.forEach(loc => {
      const tipoLimpo = loc.info[0].replace(/<[^>]*>/g, '').trim().toLowerCase();
      if (tipoLimpo.includes("tóxico")) toxicos.push(loc);
      else if (tipoLimpo.includes("doméstico")) domesticos.push(loc);
    });
    marcarEtapa(1, "🔍 Coletando dados... ✔️");

    marcarEtapa(2, "🧹 Limpando informações...");
    // A limpeza já foi feita acima, então só marcar concluído
    marcarEtapa(2, "🧹 Limpando informações... ✔️");

    const dataHoje = new Date().toLocaleDateString();

    // Função que desenha cabeçalho na página atual
    function desenharCabecalho() {
      doc.setFillColor(173, 216, 230); // azul claro
      doc.rect(0, 0, 210, 25, 'F');

      doc.setFont("arial", "bold");
      doc.setFontSize(12);
      doc.setTextColor(0, 0, 0);
      doc.text("Projeto Agro Detector", 10, 10);
      doc.text(`Data: ${dataHoje}`, 200, 10, { align: "right" });

      doc.setFontSize(11);
      doc.setTextColor(255, 0, 0);
      doc.text(`Total de Lixos Tóxicos: ${toxicos.length}`, 10, 20);
      doc.setTextColor(0, 128, 0);
      doc.text(`Total de Lixos Domésticos: ${domesticos.length}`, 100, 20);

      doc.setFont("arial", "normal");
      doc.setFontSize(14);
      doc.setTextColor(0, 0, 255);
      doc.text("Relatório de Coletas - Projeto Agro Detector", 10, 35);
      doc.setDrawColor(0);
      doc.line(10, 37, 200, 37);
    }

    // Função para carregar imagem e converter para base64 reduzida
    async function carregarImagemBase64(url, maxLargura = 600, maxAltura = 400) {
      marcarEtapa(3, "📡 Buscando imagens...");
      try {
        const img = new Image();
        img.crossOrigin = 'anonymous';

        return await new Promise((resolve, reject) => {
          img.onload = () => {
            marcarEtapa(4, "🧠 Convertendo imagens em base64...");

            // Redimensiona proporcionalmente
            let largura = img.width;
            let altura = img.height;
            const escala = Math.min(maxLargura / largura, maxAltura / altura, 1);
            largura *= escala;
            altura *= escala;

            // Cria canvas redimensionado
            const canvas = document.createElement('canvas');
            canvas.width = largura;
            canvas.height = altura;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, largura, altura);

            marcarEtapa(5, "🎨 Redimensionando imagens...");

            // Exporta em JPEG com compressão
            const base64 = canvas.toDataURL('image/jpeg', 0.7);
            resolve(base64);
          };

          img.onerror = (e) => {
            console.error("Erro ao carregar imagem:", e);
            reject(e);
          };

          img.src = url;
        });

      } catch (e) {
        console.error("Erro ao redimensionar imagem:", e);
        return null;
      }
    }

    // Função para adicionar lixos no PDF (assíncrona para tratar imagens)
    async function adicionarLixos(lista, corTexto, yStart) {
      let yLocal = yStart;

      for (const loc of lista) {
        if (yLocal > 270) {
          doc.addPage();
          desenharCabecalho();
          yLocal = 45;
        }

        // Extrair dados básicos
        const tipo = loc.info[0].replace(/<[^>]*>/g, '').trim();
        const dataHora = loc.info[1].replace("DATA/HORA: ", "").trim();
        const temp = loc.info[2].replace("Temperatura: ", "").trim();
        const lat = loc.lat.toFixed(6);
        const lng = loc.lng.toFixed(6);
        const mapsUrl = `https://maps.google.com/maps/?&z=10&q=${lat},${lng}`;

        doc.setFont("arial", "bold");
        doc.setTextColor(0, 0, 0);
        doc.text("Tipo de Lixo:", 10, yLocal);
        doc.setFont("arial", "normal");
        doc.setTextColor(...corTexto);
        doc.text(tipo, 50, yLocal);
        yLocal += 7;

        doc.setFont("arial", "bold");
        doc.setTextColor(0, 0, 0);
        doc.text("Data/Hora:", 10, yLocal);
        doc.setFont("arial", "normal");
        doc.text(dataHora, 50, yLocal);
        yLocal += 7;

        doc.setFont("arial", "bold");
        doc.text("Temperatura:", 10, yLocal);
        doc.setFont("arial", "normal");
        doc.text(temp, 50, yLocal);
        yLocal += 7;

        doc.setFont("arial", "bold");
        doc.text("Latitude:", 10, yLocal);
        doc.setFont("arial", "normal");
        doc.text(lat.toString(), 50, yLocal);
        yLocal += 7;

        doc.setFont("arial", "bold");
        doc.text("Longitude:", 10, yLocal);
        doc.setFont("arial", "normal");
        doc.text(lng.toString(), 50, yLocal);
        yLocal += 7;

        doc.setTextColor(0, 0, 255);
        doc.textWithLink("Localização no Google Maps (clique aqui)", 10, yLocal, { url: mapsUrl });
        yLocal += 10;

        // Procurar tag <img> no info e extrair src da imagem
        let imgTag = loc.info.find(i => i.includes("<img"));
        if (imgTag) {
          const srcMatch = imgTag.match(/src=['"]([^'"]+)['"]/);
          if (srcMatch && srcMatch[1]) {
            const urlImagem = srcMatch[1];

            // Marca etapa imagem
            marcarEtapa(3, "📡 Buscando imagens...");
            
            const imgBase64 = await carregarImagemBase64(urlImagem);

            if (imgBase64) {
              marcarEtapa(6, "🖨️ Inserindo no PDF...");
              doc.addImage(imgBase64, 'PNG', 150, yLocal - 40, 40, 40);
              yLocal += 5;
            } else {
              console.warn(`Não foi possível carregar a imagem: ${urlImagem}`);
            }
          }
        }

        doc.setDrawColor(200);
        doc.line(10, yLocal, 200, yLocal);
        yLocal += 10;
      }

      return yLocal;
    }

    // Desenha o cabeçalho na primeira página
    desenharCabecalho();

    let y = 45;
    y = await adicionarLixos(domesticos, [0, 128, 0], y);
    y = await adicionarLixos(toxicos, [255, 0, 0], y);

    marcarEtapa(7, "📄 Finalizando relatório...");

    const isMobile = /Android|iPhone|iPad/i.test(navigator.userAgent);
    if (isMobile) {
      const blobUrl = doc.output('bloburl');
      window.open(blobUrl, '_blank');
    } else {
      doc.save("Relatorio_Agro_Detector.pdf");
    }

  } catch (erro) {
    console.error("Erro ao gerar PDF:", erro);
    alert("Ocorreu um erro ao gerar o relatório.");
  } finally {
    // Esconde o overlay e limpa checklist
    overlay.style.display = "none";

    for(let i=1; i<=7; i++) {
      const el = document.getElementById("etapa"+i);
      if(el) el.textContent = el.textContent.replace(" ✔️", "");
    }
  }
}
  </script>

  <body>
    <!-- Conteúdo do corpo da página -->

    <footer class="footer">
      <img src="RGGUIMA/PAD.png" alt="ID">
    </footer>
  </body>

</html>
